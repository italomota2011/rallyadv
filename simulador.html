<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Simulador de GPS - Testes</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 500px; cursor: crosshair; }
        .controls { padding: 20px; background: #eee; }
    </style>
</head>
<body>
    <div class="controls">
        <h3>Simulador de Teste</h3>
        <p>1. Digite o número do carro | 2. Clique no mapa para definir o destino | 3. O simulador enviará os pontos.</p>
        Carro: <input type="number" id="simCarro" value="99">
        Velocidade Simulada: <input type="number" id="simVel" value="80"> km/h
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, update, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { /* SEU CONFIG */ };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const map = L.map('map').setView([-23.55, -46.63], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        map.on('click', function(e) {
            const id = document.getElementById('simCarro').value;
            const vel = parseFloat(document.getElementById('simVel').value);
            const {lat, lng} = e.latlng;

            // Simula o envio para o Firebase
            update(ref(db, `competidores/${id}`), {
                lat, lng, velocidade: vel, nome: "Teste Simulado", categoria: "4x4", pontos: 150000
            });

            push(ref(db, `logs/${id}`), {
                lat, lng, vel: vel, ts: Date.now()
            });

            L.circleMarker([lat, lng], {radius: 5, color: 'green'}).addTo(map);
            console.log("Ponto enviado:", lat, lng);
        });
    </script>
</body>
</html>
