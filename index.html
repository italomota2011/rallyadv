<!DOCTYPE html>
<html>
<head>
    <title>GPS Competidor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h2>Rally - Enviar Localização</h2>
    <input type="text" id="nome" placeholder="Seu Nome">
    <input type="number" id="carro" placeholder="Nº do Carro (1-100)">
    <select id="categoria">
        <option value="4x2">4x2</option>
        <option value="4x4">4x4</option>
    </select>
    <button id="btnStart">Iniciar Prova</button>
    <p id="status">Status: Offline</p>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { /* SEU CONFIG AQUI */ };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        document.getElementById('btnStart').onclick = () => {
            const num = document.getElementById('carro').value;
            const nome = document.getElementById('nome').value;
            const cat = document.getElementById('categoria').value;

            if (navigator.geolocation) {
                navigator.geolocation.watchPosition((pos) => {
                    const dados = {
                        lat: pos.coords.latitude,
                        lng: pos.coords.longitude,
                        vel: (pos.coords.speed * 3.6).toFixed(0) || 0,
                        nome: nome,
                        categoria: cat,
                        pontos: 150000,
                        timestamp: Date.now()
                    };
                    update(ref(db, 'competidores/' + num), dados);
                    // Salva no histórico para apuração posterior
                    set(ref(db, `historico/${num}/${Date.now()}`), {lat: dados.lat, lng: dados.lng, vel: dados.vel});
                    document.getElementById('status').innerText = "Enviando dados...";
                }, (err) => console.error(err), { enableHighAccuracy: true });
            }
        };
    </script>
</body>
</html>
