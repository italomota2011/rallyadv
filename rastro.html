<!DOCTYPE html>
<html>
<head>
    <title>Rastro Real-Time</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>#map { height: 100vh; width: 100%; }</style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { /* SEU CONFIG */ };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const map = L.map('map').setView([-23.55, -46.63], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        const markers = {};

        onValue(ref(db, 'competidores'), (snap) => {
            const carros = snap.val();
            for(let id in carros) {
                const c = carros[id];
                const pos = [c.lat, c.lng];
                
                if(!markers[id]) {
                    const icon = L.divIcon({
                        html: `<div style="background:red; color:white; border-radius:50%; width:25px; text-align:center; border:2px solid white;">${id}</div>`,
                        className: ''
                    });
                    markers[id] = L.marker(pos, {icon}).addTo(map).bindPopup(`Vel: ${c.velocidade} km/h`);
                } else {
                    markers[id].setLatLng(pos).getPopup().setContent(`Vel: ${c.velocidade} km/h`);
                }
            }
        });
    </script>
</body>
</html>
