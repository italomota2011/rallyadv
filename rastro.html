<!DOCTYPE html>
<html>
<head>
    <title>Análise de Rastro</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>#map { height: 500px; }</style>
</head>
<body>
    <input type="number" id="carNum" placeholder="Nº do Carro">
    <button onclick="verRastro()">Ver Percurso</button>
    <div id="map"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const app = initializeApp({ /* CONFIG */ });
        const db = getDatabase(app);
        const map = L.map('map').setView([-23.55, -46.63], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        window.verRastro = async () => {
            const num = document.getElementById('carNum').value;
            const snapshot = await get(ref(db, 'historico/' + num));
            if(snapshot.exists()){
                const coords = Object.values(snapshot.val()).map(p => [p.lat, p.lng]);
                L.polyline(coords, {color: 'red'}).addTo(map);
                map.fitBounds(coords);
            }
        };
    </script>
</body>
</html>
