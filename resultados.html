<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Ranking - Rally</title>
    <style>
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #333; color: white; }
    </style>
</head>
<body>
    <h2>Ranking Geral</h2>
    <div id="tabelas"></div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = { /* ... mesma config ... */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref('competidores').on('value', snapshot => {
            let html = "";
            let categorias = {};
            
            snapshot.forEach(c => {
                const val = c.val();
                val.id = c.key;
                if(!categorias[val.categoria]) categorias[val.categoria] = [];
                categorias[val.categoria].push(val);
            });

            for(let cat in categorias) {
                html += `<h3>Categoria: ${cat}</h3><table><tr><th>Carro</th><th>Nome</th><th>Pontos Perdidos</th><th>Total</th></tr>`;
                categorias[cat].sort((a,b) => b.pontos - a.pontos);
                categorias[cat].forEach(p => {
                    let perdidos = 150000 - p.pontos;
                    html += `<tr><td>${p.id}</td><td>${p.nome}</td><td>${perdidos}</td><td>${p.pontos}</td></tr>`;
                });
                html += `</table>`;
            }
            document.getElementById('tabelas').innerHTML = html;
        });
    </script>
</body>
</html>
