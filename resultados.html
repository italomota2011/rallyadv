<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Análise de Rastro</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>#map { height: 90vh; }</style>
</head>
<body>
    <input type="number" id="carroBusca" placeholder="Nº do Carro">
    <button onclick="verRastro()">Ver Histórico</button>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = { /* ... mesma config ... */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let map = L.map('map').setView([-12.26, -38.96], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        function verRastro() {
            let num = document.getElementById('carroBusca').value;
            db.ref('rastros/' + num).once('value', snapshot => {
                let pontos = [];
                snapshot.forEach(p => {
                    let d = p.val();
                    pontos.push([d.lat, d.lng]);
                    L.circleMarker([d.lat, d.lng], {radius: 3, color: d.vel > 80 ? 'red' : 'blue'}).addTo(map)
                        .bindPopup(`Vel: ${d.vel} km/h`);
                });
                L.polyline(pontos, {color: 'black'}).addTo(map);
                map.fitBounds(pontos);
            });
        }
    </script>
</body>
</html>
